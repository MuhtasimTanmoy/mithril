<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-mithril/core-concepts/spv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/doc/adr/rss.xml" title="Mithril RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/doc/adr/atom.xml" title="Mithril Atom Feed"><title data-rh="true">Simple Payment Verification | Mithril</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://input-output-hk.github.io/doc/mithril/core-concepts/spv"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Simple Payment Verification | Mithril"><meta data-rh="true" name="description" content="* SPV has been around in bitcoin since day 1 as a technique to verify inclusion of transactions in blocks without"><meta data-rh="true" property="og:description" content="* SPV has been around in bitcoin since day 1 as a technique to verify inclusion of transactions in blocks without"><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://input-output-hk.github.io/doc/mithril/core-concepts/spv"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/doc/mithril/core-concepts/spv" hreflang="en"><link data-rh="true" rel="alternate" href="https://input-output-hk.github.io/doc/mithril/core-concepts/spv" hreflang="x-default"><link rel="stylesheet" href="/doc/assets/css/styles.939dccdc.css">
<link rel="preload" href="/doc/assets/js/runtime~main.259e6884.js" as="script">
<link rel="preload" href="/doc/assets/js/main.32d2549b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#2e8555;color:#f1f1f1" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm">We are actively looking for SPO candidates to test Mithril on the Cardano testnet. Contact us  <a rel="noopener noreferrer" href="#">here</a> if you are interested!</div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doc/"><div class="navbar__logo"><img src="/doc/img/logo.png" alt="Mithril Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/doc/img/logo.png" alt="Mithril Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Mithril</b></a><a class="navbar__item navbar__link" href="/doc/manual/welcome">User Manual</a><a class="navbar__item navbar__link navbar__link--active" href="/doc/mithril/intro">About Mithril</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developer Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/doc/aggregator-api">Aggregator Node - API Reference</a></li><li><a href="https://mithril.network/mithril-aggregator/doc/mithril_aggregator/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Aggregator Node - Rust documentation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mithril.network/mithril-signer/doc/mithril_signer/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Signer Node - Rust documentation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mithril.network/mithril-client/doc/mithril_client/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Client Node - Rust documentation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mithril.network/mithril-core/doc/mithril/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Cryptographic Core Library - Rust documentation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://mithril.network/mithril-common/doc/mithril_common/index.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Common Node Library - Rust documentation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/doc/glossary">Glossary</a><a class="navbar__item navbar__link" href="/doc/adr">ADRs</a><a href="https://github.com/input-output-hk/mithril/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" html=":before"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj menuWithAnnouncementBar_l2a_"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/mithril/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/doc/category/core-concepts">Core Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Core Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/mithril/core-concepts/mithril-protocol">Mithril Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/mithril/core-concepts/cardano-apis">Cardano APIs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/mithril/core-concepts/certificate-details">Mithril Certificate Details</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/mithril/core-concepts/spv">Simple Payment Verification</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/category/topologies">Topologies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Topologies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/doc/category/test-lab">Test Lab</a><button aria-label="Toggle the collapsible sidebar category &#x27;Test Lab&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/doc/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/doc/category/core-concepts"><span itemprop="name">Core Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Simple Payment Verification</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Simple Payment Verification</h1><ul><li>SPV has been around in bitcoin since day 1 as a technique to verify inclusion of transactions in blocks without
verifying the whole block, and it is based on Merkle-tree proofs: Given a block header containing the root hash of the
block, a proof is a sequence of hashes representing a branch in the Merkle-tree, so verifying the proof amounts to
verifying that recursively hashing each node in the sequence yields the root hash.<ul><li>This <a href="https://developer.bitcoin.org/devguide/operating_modes.html?highlight=spv#simplified-payment-verification-spv" target="_blank" rel="noopener noreferrer">page</a>
introduces SPV in contrast with full-node mode</li><li>From a usage point of view, SPV can be used to answer to the question: &quot;Is transaction with hash <code>abc</code> part of
block <code>123</code>?&quot; without having to download the full block. The answer is a proof of inclusion and if positive one
can then download the full block</li></ul></li><li>However, to construct the proof one needs to know which transaction it is interested in and the details of the block,
so this can only be done by <em>full nodes</em>, hence SPV clients would need to find another mean to construct proofs which
is impractical<ul><li>SPV Clients <em>issuing</em> transactions can use SPV to check their inclusion in blocks easily</li><li>However if one wants to track funds from several wallets (eg. a desktop and a mobile one) then to keep this
information in sync is difficult</li></ul></li><li>To solve this problem, <a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki" target="_blank" rel="noopener noreferrer">Bloom Filters</a> have been
proposed and implemented early on (the BIP-0037 proposal dates back to 2012) in nodes and in various Lightweight
clients.<ul><li>Most notably, Android wallets based on <a href="https://bitcoinj.org/" target="_blank" rel="noopener noreferrer">bitcoinj</a> which are cited in the initial proposal</li><li><a href="https://electrum.readthedocs.io/en/latest/faq.html#how-does-electrum-work" target="_blank" rel="noopener noreferrer">Electrum</a> is another popular wallet
that uses SPV to verify transactions history. Electrum is <a href="https://github.com/spesmilo/electrum" target="_blank" rel="noopener noreferrer">open-source</a> and
coded in Python that also supports Lightning</li><li>When connecting to a peer node, lightweight clients can create and populate a bloom filter <em>on the peer side</em>,
then the peer checks every block&#x27;s content against the filter (transaction signer, addresses,...) and send a proof
of inclusion for transactions that do match.</li><li>The bloom filter can output <em>false positives</em> so there is some small probability the client will download more
blocks than needed, eg. retrieve a block that contains a transaction that did match the filter but was
uninteresting</li></ul></li><li>It <a href="https://jonasnick.github.io/blog/2015/02/12/privacy-in-bitcoinj/" target="_blank" rel="noopener noreferrer">has been found</a> quickly those Bloom filters were
actually problematic:<ul><li>They do not provide privacy as there are easy attacks that can leak the addresses the client is interested in</li><li>Nodes providing filtering service are susceptible to DoS attacks with specially crafter Bloom filters</li></ul></li><li><a href="https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki" target="_blank" rel="noopener noreferrer">BIP-0157</a>
and <a href="https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki" target="_blank" rel="noopener noreferrer">BIP-0158</a> have been proposed to mitigate those
issues. The provide so-called <em>Block filters</em> protocol which works roughly as follow:<ul><li>Nodes can maintain several disting probabilistic compressed filters based on a technique
called <a href="https://en.wikipedia.org/wiki/Golomb_coding#Rice_coding" target="_blank" rel="noopener noreferrer">Golomb-Rice Coding</a></li><li>Light clients can query <em>filter headers</em> on top of block headers, to know which filters a node maintain and then
retrieve the filters themselves, checking inclusion of items of interest on the client side</li></ul></li><li>The <a href="https://github.com/lightninglabs/neutrino" target="_blank" rel="noopener noreferrer">Neutrino</a> client is the reference implementation, and it
seems <a href="https://github.com/lightninglabs/neutrino/issues/225" target="_blank" rel="noopener noreferrer">used on mainnet</a> actively although the README has a
disclaimer stating the opposite.</li><li><a href="https://docs.wasabiwallet.io/why-wasabi/NetworkLevelPrivacy.html#full-node-by-default-block-filters-over-tor" target="_blank" rel="noopener noreferrer">wasabi</a>
uses block filters over Tor to provide SPV feature while preserving privacy.
<a href="https://github.com/bitcoinknots/bitcoin" target="_blank" rel="noopener noreferrer">Bitcoinknots</a> is a fork of bitcoin with a desktop wallet, not sure what the
differences are</li><li>SPV can also be used for sidechains pegging: <a href="https://blockstream.com/sidechains.pdf" target="_blank" rel="noopener noreferrer">https://blockstream.com/sidechains.pdf</a>. The idea is to commit from
mainchain to sidechain (and back) using SPV proof as part of the transaction so that both chains can verify the
legitimacy of the coins pegged.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="generating-a-proof-for-some-transaction-in-bitcoind">Generating a proof for some transaction in bitcoind<a class="hash-link" href="#generating-a-proof-for-some-transaction-in-bitcoind" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ bitcoin-cli getbestblockhash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000000000000003bdf6945bd7a7bea34585ab227ffc7c67715a363cb0c8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bitcoin-cli getblock 00000000000000000003bdf6945bd7a7bea34585ab227ffc7c67715a363cb0c8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bitcoin-cli getrawtransaction 757faada852390732e7a5594a33c422fe0fe350acd22bc130c6f04834964e1bf true 00000000000000000003bdf6945bd7a7bea34585ab227ffc7c67715a363cb0c8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;hex&quot;: &quot;01000000000102b2d1db9c4e77760c6455b80b2f17dff9a632a6f72f45b369d8fd6a0373371c8d0100000000ffffffff6e441290e472af49e7624602d85cb102ee9e1d1b145dcdf9a95790b38e2d62dd0000000000ffffffff0132ea0a000000000017a914d413cda9ed0f5da0e999faaafb733745b5a34b2f8702483045022100a7ab53c805ec30d3992935ab2377d065a8eddb9ece06a21e0e23546ccf383024022032d464ddba1945e75aa97c1f2e5056e7cc2bead839f89dca737f8f701190d87c0121039034647b3a86556398beef77ce25f6e443e8f91e8bc129f4aa074febaf7c3ddc0247304402202c6f92d6077e4b46388e6ff113b6c08ddfbf205aa35a0b2ca0d79416dc0229a702201a3e2dd5fae3f99eb7a549ae15133c7121ec73814cd13b15abb51ddd6794b9c90121021ed95a235418e076b099f2e6e4c9d5380c5836882efca78b33b7786e4cdd14d500000000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;blockhash&quot;: &quot;00000000000000000003bdf6945bd7a7bea34585ab227ffc7c67715a363cb0c8&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;confirmations&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;time&quot;: 1632472393,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;blocktime&quot;: 1632472393</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bitcoin-cli gettxoutproof &#x27;[&quot;757faada852390732e7a5594a33c422fe0fe350acd22bc130c6f04834964e1bf&quot;]&#x27; 00000000000000000003bdf6945bd7a7bea34585ab227ffc7c67715a363cb0c8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">04000020d99d3c79b78c541f3a50e1ba50c4b109c4cb8099e3690b0000000000000000009fac806629705a0f86d7d8055b1bd82246feef57d3f53fe09f7374926e94f89e498d4d61ebd00e170d31cfe2e30100000a688e90e8ed22687d743526c05d4dd74a89a2dd25e1b736d2ed323e306a3c35e8d131b41295c4726dcabbe7408ad794aca07692c9e79928061e837009d95bed38cb3070366525cfb69c7c586d778dc169b744c7be38c6cd955cac517fd49eab834226a203d95628b4430caa69d58ef9fced9266d060e95e552bc8ced10b38eed3bfe1644983046f0c13bc22cd0a35fee02f423ca394557a2e73902385daaa7f757c46b30755ceef3948bd3152c2fdef7ff96d8571403dfaccea7f69296b9203974962c02a390fae91fff79fd538f6bd7fcda74f9e95c9fd74785ad11f597558fdc79ba43daf35785eb4376fb54c6f7ea0173b9d671bb64a41b4b2047671f6d1adb8c31b856327a87a20fb72b9a2ff3d6c1e0ccd7a942927bc87362e1a711c21093aef143ad59c7113be896b112074671c1931562e35334ea94b92e5e1325b270503bb3500</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>The later hex-encoded bytestring is the MT proof that the txid is part of the given block.</p><p>Then one can verify the proof to retrive the transaction id:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ bitcoin-cli verifytxoutproof $(cat proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;757faada852390732e7a5594a33c422fe0fe350acd22bc130c6f04834964e1bf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="faq">FAQ<a class="hash-link" href="#faq" title="Direct link to heading">​</a></h2><ol><li>Do you see a difference between a SPV node and an SPV client or are they the same thing?</li></ol><p>As I understand it, a SPV node is really an SPV-enabled node, eg. a full node that at least can produce SPV proofs on
request, and also can handle client filters whether
through <a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki" target="_blank" rel="noopener noreferrer">Bloom filters</a>
or <a href="https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki" target="_blank" rel="noopener noreferrer">block filters</a>. I am not aware of SPV-only nodes
that would not be clients, eg. leaves in the network, because to produce a proof one has to have the whole block(s) and
not only the headers.</p><ol start="2"><li>What goes in the proof of inclusion or SPV proof?</li></ol><p>It&#x27;s the &quot;branch&quot; of the Merkle Tree that leads to the root which is stored in the block header, ie. a sequence of
transaction hashes (transaction ids) along with their siblings. Given such a branch, one can compute the root hash it
leads to by iteratively computing the hash at each node in the branch, given the previous hashes of the node&#x27;s children.
If the computed and actual block hashes are the same then the transaction <em>must</em> be in that block.</p><ol start="3"><li>What is the MT protocol?</li></ol><p>Are they <a href="https://en.wikipedia.org/wiki/Merkle_tree" target="_blank" rel="noopener noreferrer">Merkle-tree</a>? I don&#x27;t know of any <em>MT protocol</em>.</p><ol start="4"><li>Is there some more information about the size of an SPV node/ SPV client?</li></ol><p>Clients: <a href="https://wiki.bitcoinsv.io/index.php/Simplified_Payment_Verification" target="_blank" rel="noopener noreferrer">This article</a> and others mention a
current total block headers size of around 50MB. To this cost, one should add the size of the data the client is
interested in, eg. transactions and UTXO set.</p><ol start="5"><li>why is it hard for an SPV client to keep track of numerous wallets?</li></ol><p>I haven&#x27;t read any specific article on this issue but I can imagine that as the number of addresses to track increases,
so does the complexity of checking all of them at every block: Create or retrieve the filters, then retrieve the block(
s) of interest if there&#x27;s a hit, possibly trying again if it&#x27;s a false positive...</p><ol start="6"><li>I&#x27;ve read somewhere that not every SPV node keeps a UTXO state, is there more information about how they manage this?</li></ol><p>I don&#x27;t know</p><ol start="7"><li>Do you think this improved Bloom filters is something that we should explorer in the context of Mithril?</li></ol><p>Yes. I don&#x27;t know if it makes sense cryptographically, but if we could in some way derive a certificate for each block
filter, given a global certificate, that would allow lightweight clients and full (or mithril-aware) nodes to interact
through a similar protocol: Get a root certificate, verify it against previously known &quot;Safe&quot; state, then filter the
available UTXO set using deterministic block filters.</p><ol start="8"><li>Why cannot we run plain SPV on Cardano?</li></ol><p>Cardano being a Proof-of-Stake chain has different tradeoffs when it comes to validating blocks. In bitcoin, the
Proof-of-Work puzzle is part of the header hence it&#x27;s easy to limit verification process to headers. In Cardano,
validity of a block depends on current stake distribution and knowing the stake distribution requires going through all
transactions in a block and update the stakes accordingly. Because the stake distribution is large, putting it in block
headers is also impractical.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="emulating-spv-with-mithril">Emulating SPV with Mithril<a class="hash-link" href="#emulating-spv-with-mithril" title="Direct link to heading">​</a></h2><p>Actually, I think we could not use
the <a href="https://github.com/input-output-hk/hydra-poc/tree/master/merkle-patricia-tree" target="_blank" rel="noopener noreferrer">Merkle-Patricia Tree</a> we&#x27;ve been
building for Hydra for that purpose:</p><ul><li>Mithril certificate signs the root hash of a MPT built from the UTXO set<ul><li>Note the MPT can be built incrementally at each block/epoch, deleting and adding UTXO</li><li>Perhaps it would make more sense to store transactions&#x27; id in a basic Merkle-Tree</li></ul></li><li>Mithril nodes maintain block filters<ul><li>We could use Golomb-Rice coded sets as proposed in BIP-0158 to provide compact filters</li><li>Filters should index all addresses in the UTXO set, at least, to enable light clients to lookup transactions of
interest only</li></ul></li><li>Clients can retrieve block filters and certificate, then request specific Transactions/Blocks<ul><li>It&#x27;s unclear what a light client would need, probably transactions are enough?</li></ul></li><li>Mithril node sends requested UTXO/Transaction set along with proof it&#x27;s part of the MPT<ul><li>False positives are simply ignored</li><li>The proof guarantees the UTXO/Transaction is in the root hence has been signed</li></ul></li></ul><p>I
wrote <a href="https://github.com/input-output-hk/mithril/blob/29b0209ba90d39d02f366ca526485d2474935f5e/test/Mithril/FilterSpec.hs" target="_blank" rel="noopener noreferrer">some code</a>
experimenting with:</p><ul><li>Storing the UTXO set in a Merkle-Patricia-Tree indexed by reference (transaction id + transaction index)</li><li>Building a Bloom filter for addresses in the UTXO set</li></ul><p>Some basic measures I made, given a set of 10000 UTXO:</p><ul><li>Utxo size (serialised) is: 151MB</li><li>Bloom Filter size is: 32KB</li><li>Proof size: 552B</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/input-output-hk/mithril/tree/main/docs/root/root/mithril/core-concepts/spv.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/doc/mithril/core-concepts/certificate-details"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mithril Certificate Details</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/doc/category/topologies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Topologies</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generating-a-proof-for-some-transaction-in-bitcoind" class="table-of-contents__link toc-highlight">Generating a proof for some transaction in bitcoind</a></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li><li><a href="#emulating-spv-with-mithril" class="table-of-contents__link toc-highlight">Emulating SPV with Mithril</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/input-output-hk/mithril/wiki/Project-Charter" target="_blank" rel="noopener noreferrer" class="footer__link-item">Project Charter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/doc/adr">Architectural Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/input-output-hk/mithril/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cardano.stackexchange.com/questions/tagged/mithril" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Exchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/input-output-hk/mithril/wiki/Logbook" target="_blank" rel="noopener noreferrer" class="footer__link-item">Logbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Input Output (Blog)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 <strong>Input Output</strong> <br> <small>Built with Docusaurus</small></div></div></div></footer></div>
<script src="/doc/assets/js/runtime~main.259e6884.js"></script>
<script src="/doc/assets/js/main.32d2549b.js"></script>
</body>
</html>